<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ ë·°ì–´</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
        #log-container { width: 100%; height: 700px; overflow-y: scroll; background: #fff; padding: 10px; border: 1px solid #ccc; }
        .log-line { white-space: pre-wrap; font-family: monospace; }
        #date-picker { margin-bottom: 10px; }
    </style>
</head>
<body>

<h2>ë¡œê·¸ ë·°ì–´</h2>
<label for="date-picker">ë‚ ì§œ ì„ íƒ:</label>
<input type="date" id="date-picker">
<button onclick="loadLogs()">ë¡œê·¸ ê°€ì ¸ì˜¤ê¸°</button>
<p><strong>ì‹¤ì‹œê°„ ë¡œê·¸</strong></p>
<div id="log-container"></div>

<script>
    const logContainer = document.getElementById("log-container");
    const socket = io()  // WebSocket ì—°ê²°

    // ì˜¤ëŠ˜ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸° (YYYY-MM-DD í˜•ì‹)
    function getTodayDate() {
        const today = new Date();
        return today.toISOString().split("T")[0]; // "YYYY-MM-DD" í˜•ì‹ ë°˜í™˜
    }

    // ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì„ íƒ ë° ë¡œê·¸ ë¡œë“œ
    window.onload = function() {
        document.getElementById("date-picker").value = getTodayDate();
        loadLogs();  // ìë™ìœ¼ë¡œ ì˜¤ëŠ˜ ë‚ ì§œ ë¡œê·¸ ê°€ì ¸ì˜¤ê¸°
    };

    // ì‹¤ì‹œê°„ ë¡œê·¸ ì—…ë°ì´íŠ¸ (ì˜¤ëŠ˜ ë¡œê·¸ì¼ ë•Œë§Œ WebSocket ì‚¬ìš©)
    socket.on("log_update", (data) => {
        const selectedDate = document.getElementById("date-picker").value;
        if (selectedDate === getTodayDate()) {
            const logLine = document.createElement("div");
            logLine.classList.add("log-line");
            logLine.textContent = data.log;
            logContainer.appendChild(logLine);
            logContainer.scrollTop = logContainer.scrollHeight; // ìë™ ìŠ¤í¬ë¡¤
        }
    });

    // ë‚ ì§œë³„ ë¡œê·¸ ê°€ì ¸ì˜¤ê¸°
    function loadLogs() {
        const dateInput = document.getElementById("date-picker").value;
        if (!dateInput) {
            alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
            return;
        }

        // YYYY-MM-DD â†’ YYMMDD ë³€í™˜
        const formattedDate = dateInput.replace(/-/g, "").slice(2);

        fetch(`/func/logs/${formattedDate}`, { cache: "no-cache" })  // ğŸ”¥ ìºì‹± ë°©ì§€ ì¶”ê°€
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    logContainer.innerHTML = `<p style="color:red;">${data.error}</p>`;
                } else {
                    logContainer.innerHTML = "";
                    data.logs.forEach(log => {
                        const logLine = document.createElement("div");
                        logLine.classList.add("log-line");
                        logLine.textContent = log;
                        logContainer.appendChild(logLine);
                    });
                    logContainer.scrollTop = logContainer.scrollHeight;
                }
            })
            .catch(error => console.error("ë¡œê·¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error));
    }
</script>


</body>
</html>
