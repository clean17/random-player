<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>{{ post.title }}</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css?v={{ version }}">
    <link rel="stylesheet" href="/static/css/post.css?v={{ version }}">
</head>
<body>
<div class="top-bar">
    <div class="logout">
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('auth.logout') }}">Logout</a>
        {% endif %}
    </div>
    <div class="back">
        <a href="{{ url_for('main.home') }}">Back</a>
    </div>
</div>

<div class="container">
    <div class="form-group">
        <div class="post-info">
            <div class="view-post-title">{{ post.title }}</div>
            <div class="post-meta">{{ post.realname or '이름 없음' }} &nbsp;|&nbsp; {{ post.updated_at }}</div>
        </div>
    </div>
    <div class="form-group" style="display: none">
        <label for="author">작성자</label>
        <input type="text" name="author" id="author" value="{{ post.realname or ''}}" disabled>
    </div>
    <hr>
    <!--<div class="form-group">
        <label for="content">첨부</label>
        <input type="file" name="file" id="file"/>
    </div>-->
    <div class="form-group textarea-wrapper">
        <pre name="content" id="content" readonly>{{ post.content or ''}}</pre>
    </div>
    <div class="form-actions">
        {% if post.user_id == user.id %}
        <button type="button" class="btn btn-danger" id="delete-post">삭제</button>
        <button type="submit" class="btn btn-main" onclick="window.location.href='/posts/{{ post.id }}/edit'">수정</button>
        {% endif %}
        <button type="button" class="btn-secondary" onclick="window.location.href='/posts'">목록으로</button>
    </div>
</div>
</body>
<script>
    const deletePostBtn = document.getElementById('delete-post');

    deletePostBtn.addEventListener('click', () => {
        if (confirm('삭제하시겠습니까?')) {
            axios.post("/posts/{{ post.id }}/del", {}, {
                headers: {"Content-Type": "application/json"},
                timeout: 3000 // 3초 초과시 자동 reject
            }).then(async res => {
                if ("true" === res.data.result) {
                    window.location.replace("/posts");
                }
            }).catch(error => {
                throw error; // 기타 에러는 그대로 던짐
            });
        }
    })
</script>
</html>
